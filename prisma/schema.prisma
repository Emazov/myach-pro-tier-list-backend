generator client {
    provider = "prisma-client-js"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Модель пользователя Telegram
model TelegramUser {
    id         Int      @id @default(autoincrement())
    telegramId BigInt   @unique @map("telegram_id")
    username   String?
    firstName  String?  @map("first_name")
    lastName   String?  @map("last_name")
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")

    files File[] @relation("TelegramUserFiles")

    @@map("telegram_users")
}

// Модель файла
model File {
    id          Int      @id @default(autoincrement())
    key         String   @unique
    filename    String
    contentType String   @map("content_type")
    size        Int?
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")
    description String?  @map("description")

    telegramUserId Int?          @map("telegram_user_id")
    telegramUser   TelegramUser? @relation("TelegramUserFiles", fields: [telegramUserId], references: [id])

    // Связи с релизами и игроками
    releaseLogoId Int?     @unique @map("release_logo_id")
    release       Release? @relation("ReleaseLogo", fields: [releaseLogoId], references: [id])

    playerPhotoId Int?    @unique @map("player_photo_id")
    player        Player? @relation("PlayerPhoto", fields: [playerPhotoId], references: [id])

    @@map("files")
}

// Модель выпуска (релиза)
model Release {
    id          Int      @id @default(autoincrement())
    name        String
    description String?
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")

    // Логотип клуба
    logoFile File? @relation("ReleaseLogo")

    // Связь с игроками
    players Player[]

    @@map("releases")
}

// Модель игрока
model Player {
    id          Int      @id @default(autoincrement())
    name        String
    position    String?
    number      Int?
    description String?
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")

    // Связь с выпуском
    releaseId Int     @map("release_id")
    release   Release @relation(fields: [releaseId], references: [id])

    // Связь с фотографией
    photoFile File? @relation("PlayerPhoto")

    @@map("players")
}
